<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.31.1" />
  <meta name="author" content="Mohit Sharma">
  <meta name="description" content="Associate Research Scientist">

  
  <link rel="alternate" hreflang="en-us" href="/project/cuic/">

  
  


  

  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  
  <link rel="stylesheet" href="/css/jupyter.css">
  

  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-80699217-1', 'auto');
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Mohit Sharma">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Mohit Sharma">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/project/cuic/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Mohit Sharma">
  <meta property="og:url" content="/project/cuic/">
  <meta property="og:title" content="cuic | Mohit Sharma">
  <meta property="og:description" content=""><meta property="og:image" content="/img/cuic/cuic_banner.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2017-12-12T21:42:55-05:00">
  
  <meta property="article:modified_time" content="2017-12-12T21:42:55-05:00">
  

  

  <title>cuic | Mohit Sharma</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Mohit Sharma</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        

        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#publications_selected">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#teaching">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article article-project" itemscope itemtype="http://schema.org/Article">

  
<div class="article-header">
  <img src="/img/cuic/cuic_banner.png" class="article-banner" itemprop="image">
  <span class="article-header-caption">NYU CUSP UO</span>
</div>



  <div class="article-container">

    <div class="pub-title">
      <h1 itemprop="name">cuic</h1>
      <span class="pub-authors" itemprop="author">&nbsp;</span>
      <span class="pull-right">
        
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=cuic&amp;url=%2fproject%2fcuic%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fproject%2fcuic%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fproject%2fcuic%2f&amp;title=cuic"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fproject%2fcuic%2f&amp;title=cuic"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=cuic&amp;body=%2fproject%2fcuic%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


      </span>
    </div>

    

    <div class="article-style" itemprop="articleBody">
      

<h2 id="introduction">Introduction</h2>

<p>This project is aimed at developing a streamlined framework/pipeling for using
different cameras and their different SDKs (Software Development Kits) for
performing different operations on the cameras.</p>

<p>Most high performance SDKs provided by camera manufacturers is written
in C or sometimes in C++. The aim of this project is to use the different SDKs
that are in use at NYU CUSP and write a complete multi-threaded application
for performing the following tasks:</p>

<ul>
<li>Connecting to the camera(s).</li>
<li>Changing the camera and image configurations programmatically (such as exposure,
gain, focus, framerate, etc).</li>
<li>Capturing the image and buffering it to the RAM (tmpfs / ramfs).</li>
<li>Having the &ldquo;image-saving&rdquo; be performed in a separate thread.</li>
<li>Have fail-safe techniques to make sure that in rare occurences, if the camera
disconnects or the application crashes, it can come back automatically once.
the link to the camera is re-established (which may require physical intervention)</li>
<li>Images be timestamped with high precision.</li>
<li>Should be able to save 1 RAW (bayer GB8 or similar)
image every 10 seconds (at-least).</li>
<li>System should be able to &lsquo;plug-in&rsquo; to the existing parallel
<a href="https://sharmamohit.com/project/cuip" target="_blank">CUIP - Cusp Urban Image Processing Pipeline</a> project</li>
</ul>

<p>Performing these may get a little complicated in C, so writing a C++ (11 or higher)
Python wrapper (or a mix of both) is required.</p>

<h2 id="current-state">Current State</h2>

<p>The CUIC project is currently hosted on <a href="https://github.com/Mohitsharma44/cuic" target="_blank">GitHub</a>
and is being actively developed using two SDKs at the time of writing
Following are the SDK&rsquo;s currently in use:</p>

<table>
<thead>
<tr>
<th>SDK</th>
<th>Website</th>
<th>Cameras Driven</th>
</tr>
</thead>

<tbody>
<tr>
<td>Pleora</td>
<td><a href="https://supportcenter.pleora.com/s/article/eBUS-SDK-Software-and-Release-Notes-Dwnload" target="_blank">https://supportcenter.pleora.com/s/article/eBUS-SDK-Software-and-Release-Notes-Dwnload</a></td>
<td>Baumer LXG-200C (x2)</td>
</tr>

<tr>
<td>Teledyne</td>
<td><a href="https://www.teledynedalsa.com/imaging/support/downloads/package/132/" target="_blank">https://www.teledynedalsa.com/imaging/support/downloads/package/132/</a></td>
<td>Teledyne Dalsa Genie TS-C4096</td>
</tr>

<tr>
<td>CEmergent*</td>
<td><a href="https://emergentvisiontec.com/products/esdk/" target="_blank">https://emergentvisiontec.com/products/esdk/</a></td>
<td>Emergent HS12000C</td>
</tr>
</tbody>
</table>

<p>*Another similar project <a href="https://github.com/Mohitsharma44/CEmergent" target="_blank">CEmergent</a> is
hosted on Github as well which deals with a special SFP+ connectivity based
scientific camera.</p>

<p><br/></p>

<h2 id="working">Working</h2>

<h3 id="using-pleora">Using_Pleora</h3>

<p>Using the pleora SDK is pretty straight-forward.
This module has libconfig as a dependency on top of having pleora SDK. This
is to assist in making the configuration file for the camera more readable
as it follows the generic json-like format.</p>

<p>Any configuration setting should be added to the <code>configuration.cfg</code> file and
must be placed at <code>/opt/pleora/ebus_sdk/Ubuntu-14.04-x86_64/share/samples/cuic/using_pleora/src/</code>*.
This is just a silly way of making sure you have installed pleora SDK.</p>

<p><br/>
When the module is started for the first time, it reads out the camera
settings from the camera&rsquo;s memory and dumps it to the file (whose name is
same as the camera&rsquo;s MAC address.</p>

<p><br/>
One of the other dependency for this project is <a href="https://github.com/gabime/spdlog" target="_blank">spdlog</a>
which is used for multi-threaded logging (to console and to the file). By default
all the logs are written to <code>/var/log/cuic/cuicCapture</code> and gets backed-up daily
at midnight.</p>

<p><br/>
To transfer the images securely, we use lsyncd (live Syncing Daemon) which basically
monitors a particular directory (hardcoded as /mnt/ramdisk in the cpp code which is
basically a tmpfs of 1GB size) for new images and uses an existing <code>ssh</code> tunnel
to transfer those images using <code>rsync</code> to a remote target/ server.</p>

<p><br/>
<strong>Utils</strong></p>

<p>To make sure the code keeps running and is resilient to crashes, we use supervisord,
a python process control system module for restarting the cuic module in case
of a crash, retry in case of network issues and number of times to retry starting
the cuic module in case there is a system issue. We also use <code>crontab</code> for starting
and stopping our processes (via supervisor) at certain times to take images.</p>

<p>The configuration for lsyncd and supervisord can be found in the <a href="https://github.com/Mohitsharma44/cuic/tree/master/using_pleora/utils" target="_blank">utils</a> subdirectory</p>

<blockquote>
<ul>
<li>*cuic  is where you clone this repo</li>
<li>Make sure you have write permissions in <code>/var/log/cuic/</code> for logging</li>
</ul>
</blockquote>

<h3 id="using-teledyne">Using_Teledyne</h3>

<p>Unlike Pleora SDK which can work with any camera manufacturer (as long as you buy
a license from them), teledyne SDK only works with the cameras that are manufactured
by Teledyne Dalsa. Moreover their support is primarily for Windows based Sapera SDK.
However, they do provide a .. what I would call a .. <code>partially documented</code> SDK
for linux distribution. So getting this thing up and running quite frankly took me
a bit of time. Their demo code infact refused to compile on my Ubuntu Linux 16.04
(running kernel 4.10) and required some modifications.</p>

<p><br/>
Anyway, the major plus of using this SDK is that it doesn&rsquo;t lock up the camera
after let&rsquo;s say a seg fault or a memory reference error. This is something that is
horrible with Pleora or CEmergent for that matter. Unlike the other SDKs, the teledyne
dalsa SDK releases the camera in case the code crashes and the camera can be
re-connected to the daemon in ~10-20 seconds (after the code that was using the
camera crashes). So thumbs up to those guys!!</p>

<p><br/>
The current version of the <a href="https://github.com/Mohitsharma44/cuic/tree/master/using_teledyne/README.md" target="_blank">README</a>
file can be used to setup the system and get things up and running. One major thing
to remember is that this module uses <a href="https://github.com/SergiusTheBest/plog" target="_blank">plog</a>
logging library (I just wanted to test this library&rsquo;s speed..
its good but does miss the logs at times when the logs are flowing at speed of ~1/sec)
Also, this module strictly uses CmakeLists files for compiling (for ease of portability)
so your project should follow this structure:</p>

<pre><code class="language-bash">- capture_code
  | - cpp file
  | - archdefs.mk
  | - corenv.h
  | - CMakeLists.txt
  [] - Makefile*
  | - cmake
    | - Modules
      | - ...
- common
  | - GevUtils.c
  | - SapExUtil.c
  | - SapExUtil.h
  | - SapX11Util.h
  | - X_Display_utils.c
  | - X_Display_utils.h
- plog
  | - &lt;...&gt;.h
  | - ...

</code></pre>

<p><br/>
A major difference between this module vs all the others is that
this one is a prototype for using AMQP (Advanced Messaging Queue Protocol)
to serve the RPC (Remote Procedure Call) requests over the network
so that the cameras can be interfaced with the
<a href="https://github.com/Mohitsharma44/UOController" target="_blank">UOController</a> commandline tool (
and hopefully someday using chatbot or voice command)</p>

<p><br/>
<strong>Installation</strong></p>

<p>This code also requires <code>boost</code> library, rabbitmq and <code>rabbitmq-c</code> (the C implementation
of the <code>rabbitmq</code>). The <code>boost</code> library needs to be installed manually with
<code>system</code> and <code>chrono</code> libraries. <code>rabbitmq-c</code> is installed by the <code>cmake</code> module</p>

<p>For more installation instructions, refer the <a href="https://github.com/Mohitsharma44/cuic/blob/master/using_teledyne/README.md" target="_blank">README</a>
file</p>

<p><br/>
<strong>Execution Examples</strong></p>

<p>To run the code:</p>

<ul>
<li>Clone the repo and create a <code>build</code> directory inside <code>using_teledyne</code>.</li>
<li><code>cd</code> into <code>build</code> and  run <code>cmake ..</code></li>
<li>If everything succeded, then run <code>make</code></li>
<li>Now, execute <code>./capture_demo/genicam_cpp_demo</code></li>
</ul>

<p>To send commands via rabbitmq broker:</p>

<ul>
<li><code>cd</code> into <code>amqpcpp_example</code> and create a <code>build</code> directory.</li>
<li><code>cd</code> into the <code>build</code> and run <code>cmake ..</code></li>
<li>If everything succeded, then run <code>make</code></li>
<li>Now, execute <code>./rpc_client 5</code> (to take 5 images)</li>
</ul>

<p>The rpc_client (well, the capture code actually) supports following commmand-line
arguments:</p>

<ul>
<li>&lsquo;a&rsquo;: To abort any function</li>
<li>&rsquo;?&rsquo;: To print help function / return help function</li>
<li>&rsquo;t&rsquo;: To see if your machine supports turbo-mode</li>
<li>&lsquo;g&rsquo;: for capturing images forever at max speed (fps)</li>
<li>&rsquo;s&rsquo;: To stop acquiring images</li>
<li>&lsquo;q&rsquo;: To quit</li>
<li>&lsquo;&lt;integer&gt;&lsquo;: To capture that many images at max speed (fps)</li>
</ul>

    </div>

    


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/imaging">imaging</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/c">c</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/c&#43;&#43;">c&#43;&#43;</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/python">python</a>
  
</div>




    
    
    

    
      
      
      
      

      
      
      
      
    

  </div>
</article>

<div class="container">
  <nav>
  <ul class="pager">
    
    <li class="previous"><a href="/project/sonyc/"><span
      aria-hidden="true">&larr;</span> Sounds of New York City (Sonyc)</a></li>
    

    
    <li class="next"><a href="/project/uocontroller/">UoController <span
      aria-hidden="true">&rarr;</span></a></li>
    
  </ul>
</nav>

</div>

<footer class="site-footer">
  <div class="container">

    <p class="powered-by">

      &copy; 2017 Mohit Sharma &middot; 

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    <script id="dsq-count-scr" src="//mohitsharma44.disqus.com/count.js" async></script>
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

